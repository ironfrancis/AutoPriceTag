# 整页排版使用说明

## 功能概述

整页排版功能允许您将多个已保存的标签混合排列到标准尺寸的画布上（如A4、5寸、6寸、7寸等），便于批量打印。

## 使用流程

### 1. 准备工作

在开始整页排版之前，您需要先在**标签编辑器**中创建并保存标签：

1. 访问 `/editor` 标签编辑器
2. 设计您的标签
3. 填写商品信息
4. 调整尺寸和样式
5. 点击「保存标签」按钮

### 2. 进入整页排版

1. 访问 `/page-layout` 整页排版页面
2. 页面会自动加载您所有已保存的标签

### 3. 选择画布尺寸

在页面顶部的工具栏中选择画布尺寸：
- **A4纸张**（210×297mm）- 默认
- **A3纸张**（297×420mm）
- **5寸照片**（127×89mm）
- **6寸照片**（152×102mm）
- **7寸照片**（178×127mm）
- **小型/中型/大型标签纸**

### 4. 选择要排版的标签

在右侧的「选择标签」面板中：
1. 从已保存的标签列表中勾选您要排版的标签
2. 可以勾选多个标签
3. 底部会显示已选择的标签数量

**提示：**
- 勾选的标签会高亮显示
- 点击标签可以切换选择状态
- 可以点击「刷新」按钮重新加载标签列表

### 5. 自动排版

点击「自动排版到画布」按钮：
1. 系统会自动计算最优的排列方式
2. 标签会被排列成网格（行列布局）
3. 如果画布上已有标签，系统会询问是否替换

**自动排列规则：**
- 根据画布尺寸和标签尺寸计算最多能放多少个
- 从左到右、从上到下排列
- 标签间距默认2mm
- 画布边距默认5mm
- 标签区域自动居中显示

### 6. 手动调整（可选）

如果需要微调标签位置：
1. **拖拽移动**：点击标签拖拽到新位置
2. **缩放查看**：使用工具栏的缩放按钮
3. **平移画布**：按住 Shift + 拖拽画布背景

**操作提示：**
- 点击标签可以选中（会显示蓝色边框）
- 选中后可以按 Delete 删除
- 使用「重置视图」按钮恢复初始显示

### 7. 导出打印

排版完成后：
1. 点击右上角的「导出」按钮
2. 选择导出格式：
   - **PNG 图片** - 适合直接打印或插入文档
   - **JPG 图片** - 体积较小的图片格式
   - **PDF 文档** - 适合专业打印
3. 文件会自动下载

## 高级功能

### 重复添加同一标签

如果您需要打印多个相同的标签：
1. 勾选要重复的标签（只选择一个）
2. 点击「自动排版到画布」
3. 在弹出的对话框中输入重复次数
4. 确认后，系统会在画布上自动排列指定数量的相同标签

### 网格辅助线

点击工具栏的网格图标可以：
- 开启/关闭网格辅助线
- 网格大小：10mm
- 帮助您对齐标签

### 清空画布

如果排版不满意：
1. 点击「清空画布」按钮
2. 确认清空操作
3. 画布上的所有标签将被清除

### 重新排版

如果对自动排版的位置不满意：
1. 点击「自动排列」按钮
2. 所有标签会重新计算位置并居中排列

## 常见问题

### Q: 为什么看不到已保存的标签？

**A:** 可能的原因：
1. 您还没有保存任何标签（请先在 `/editor` 创建）
2. 数据存储在浏览器本地，更换浏览器或清空缓存会丢失
3. 页面刚加载，标签还在加载中（请等待几秒）

**解决方案：**
- 确保已在标签编辑器中创建并保存标签
- 点击「刷新」按钮手动刷新列表
- 查看浏览器控制台的日志信息

### Q: 选择的标签没有添加到画布？

**A:** 请检查：
1. 是否勾选了标签（选中状态为蓝色高亮）
2. 点击了「自动排版到画布」按钮
3. 查看浏览器控制台的错误信息

**调试步骤：**
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签
3. 应该看到类似这样的日志：
   ```
   已加载的标签数量: X
   选择的标签: Y 个
   添加标签到画布: Y 个标签
   自动布局计算完成，生成实例: Z
   ```

### Q: 标签太小看不清？

**A:** 使用缩放功能：
1. 点击工具栏的放大按钮（+）
2. 使用鼠标滚轮（Ctrl/Cmd + 滚轮）
3. 将画布放大到合适的尺寸
4. 需要恢复时点击「重置视图」按钮

### Q: 如何调整标签间距？

**A:** 目前间距是固定的（2mm），如需调整：
1. 使用手动拖拽将标签分开
2. 或导出了进行后期编辑

### Q: 导出的文件不清晰？

**A:** 系统以 300 DPI 导出，适合打印。如果不够清晰：
1. 确保使用画布的原始尺寸
2. 避免过度缩放
3. 使用 PNG 或 PDF 格式

### Q: 能否同时排版不同类型的标签？

**A:** 可以！系统会自动适应不同尺寸的标签：
1. 勾选所有需要排版的标签
2. 点击「自动排版到画布」
3. 系统会尽量在画布上排列所有标签
4. 如果标签尺寸差异大，可能需要手动调整位置

## 最佳实践

1. **提前设计**：在标签编辑器中设计好所有标签
2. **批量保存**：保存所有需要的标签到列表
3. **合理选择**：选择尺寸相近的标签一起排版，效果更好
4. **先预览**：排版后先检查，再导出
5. **小批量测试**：首次使用时先排版少量标签测试效果

## 技术说明

### 自动布局算法

系统使用智能网格算法：
1. 根据画布尺寸和标签尺寸计算最大行列数
2. 自动计算起始位置（居中）
3. 按行排列标签，保持统一间距
4. 考虑边距，确保不超出画布

详细算法说明请查看：[整页排版自动布局算法.md](整页排版自动布局算法.md)

### 缩放和坐标系统

- **画布尺寸**：以毫米（mm）为单位
- **显示尺寸**：自动适应浏览器窗口
- **缩放范围**：30% ~ 200%
- **默认缩放**：自动计算以适合窗口

## 快捷键

- **Ctrl + 滚轮**：缩放画布
- **Shift + 拖拽**：平移画布
- **点击标签**：选中/取消选中
- **拖拽标签**：移动标签位置
